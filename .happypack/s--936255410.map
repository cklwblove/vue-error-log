{"version":3,"sources":["src/index.js"],"names":["Vue","Raven","RavenVue","plugin","options","formatComponentName","vm","$root","name","_isVue","$options","_componentTag","__file","dsn","console","warn","config","release","addPlugin","install","setUserContext","user","setTagsContext","environment","env","require","errorHandler","err","info","error","componentName","propsData","captureException","level","tags","svn_commit","extra","prototype","$raven","value","writable"],"mappings":";AAAA,OAAOA,GAAP,MAAgB,KAAhB;AACA,OAAOC,KAAP,MAAkB,UAAlB;AACA,OAAOC,QAAP,MAAqB,sBAArB;;AAEA,SAASC,MAAT,GAA+B;AAAA,MAAdC,OAAc,uEAAJ,EAAI;;AAC7B,WAASC,mBAAT,CAA6BC,EAA7B,EAAiC;AAC/B,QAAIA,GAAGC,KAAH,KAAaD,EAAjB,EAAqB,OAAO,MAAP;;AAErB,QAAME,OAAOF,GAAGG,MAAH,GAAaH,GAAGI,QAAH,IAAeJ,GAAGI,QAAH,CAAYF,IAA5B,IAAsCF,GAAGI,QAAH,IAAeJ,GAAGI,QAAH,CAAYC,aAA7E,GAA8FL,GAAGE,IAA9G;AACA,WAAO,CAACA,OAAO,gBAAgBA,IAAhB,GAAuB,GAA9B,GAAoC,qBAArC,KAA+DF,GAAGG,MAAH,IAAaH,GAAGI,QAAhB,IAA4BJ,GAAGI,QAAH,CAAYE,MAAxC,GAAiD,UAAUN,GAAGI,QAAH,IAAeJ,GAAGI,QAAH,CAAYE,MAArC,CAAjD,GAAgG,EAA/J,CAAP;AACD;;AAED,MAAI,CAACR,QAAQS,GAAb,EAAkB;AAChBC,YAAQC,IAAR,CAAa,+BAAb;AACA;AACD;;AAGDd,QAAMe,MAAN,CAAaZ,QAAQS,GAArB,EACE;AACEI,aAASb,QAAQa;AADnB,GADF,EAIGC,SAJH,CAIahB,QAJb,EAIuBF,GAJvB,EAKGmB,OALH;;AAOAlB,QAAMmB,cAAN,CAAqB;AACnBC,UAAMjB,QAAQiB,IAAR,IAAgB;AADH,GAArB;;AAIApB,QAAMqB,cAAN,CAAqB,EAACC,aAAanB,QAAQoB,GAAtB,EAArB;;AAGAC,UAAQ,aAAR;;AAEAzB,MAAIgB,MAAJ,CAAWU,YAAX,GAA0B,UAAUC,GAAV,EAAerB,EAAf,EAAmBsB,IAAnB,EAAyB;AACjDd,YAAQe,KAAR,CAAc,qBAAqBF,GAAnC;AACA,QAAMG,gBAAgBzB,oBAAoBC,EAApB,CAAtB;AACA,QAAMyB,YAAYzB,GAAGI,QAAH,IAAeJ,GAAGI,QAAH,CAAYqB,SAA7C;;AAEA9B,UAAM+B,gBAAN,CAAuBL,GAAvB,EAA4B;AAC1BM,aAAO,OADmB;AAE1BC,YAAM;AACJC,oBAAY;AADR,OAFoB;AAK1BC,aAAO;AACLN,uBAAeA,aADV;AAELC,mBAAWA,SAFN;AAGLH,cAAMA;AAHD;AALmB,KAA5B;AAWD,GAhBD;;AAkBA,2BAAwB5B,IAAIqC,SAA5B,EAAuC;AACrCC,YAAQ,EAAEC,OAAOtC,KAAT,EAAgBuC,UAAU,IAA1B;AAD6B,GAAvC;AAGD;;AAED,eAAerC,MAAf","file":"index.js","sourceRoot":"/Users/liwb/Desktop/liwb_work/cloud/vue-error-log","sourcesContent":["import Vue from 'vue';\nimport Raven from 'raven-js';\nimport RavenVue from 'raven-js/plugins/vue';\n\nfunction plugin (options = {}) {\n  function formatComponentName(vm) {\n    if (vm.$root === vm) return 'root';\n\n    const name = vm._isVue ? (vm.$options && vm.$options.name) || (vm.$options && vm.$options._componentTag) : vm.name;\n    return (name ? 'component <' + name + '>' : 'anonymous component') + (vm._isVue && vm.$options && vm.$options.__file ? ' at ' + (vm.$options && vm.$options.__file) : '');\n  }\n\n  if (!options.dsn) {\n    console.warn('sentry dsn must be set value.');\n    return;\n  }\n\n  // init raven\n  Raven.config(options.dsn,\n    {\n      release: options.release\n    })\n    .addPlugin(RavenVue, Vue)\n    .install();\n\n  Raven.setUserContext({\n    user: options.user || ''\n  });\n\n  Raven.setTagsContext({environment: options.env});\n\n  // global error\n  require('./globalLog');\n  // vue errorHandler\n  Vue.config.errorHandler = function (err, vm, info) {\n    console.error('这里是errorHandler：' + err);\n    const componentName = formatComponentName(vm);\n    const propsData = vm.$options && vm.$options.propsData;\n\n    Raven.captureException(err, {\n      level: 'error',\n      tags: {\n        svn_commit: 'vue'\n      },\n      extra: {\n        componentName: componentName,\n        propsData: propsData,\n        info: info\n      }\n    });\n  };\n  // 挂载到vue属性上\n  Object.defineProperties(Vue.prototype, {\n    $raven: { value: Raven, writable: true }\n  });\n}\n\nexport default plugin;\n"]}