{"version":3,"sources":["src/index.js"],"names":["Raven","RavenVue","plugin","Vue","options","formatComponentName","vm","$root","name","_isVue","$options","_componentTag","__file","dsn","console","warn","config","release","addPlugin","install","setUserContext","user","setTagsContext","environment","env","require","errorHandler","err","info","error","componentName","propsData","captureException","level","tags","svn_commit","extra","prototype","$raven","version","window","use"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,UAAlB;AACA,OAAOC,QAAP,MAAqB,sBAArB;;AAEA,SAASC,MAAT,CAAiBC,GAAjB,EAAoC;AAAA,MAAdC,OAAc,uEAAJ,EAAI;;AAClC,WAASC,mBAAT,CAA6BC,EAA7B,EAAiC;AAC/B,QAAIA,GAAGC,KAAH,KAAaD,EAAjB,EAAqB,OAAO,MAAP;;AAErB,QAAME,OAAOF,GAAGG,MAAH,GAAaH,GAAGI,QAAH,IAAeJ,GAAGI,QAAH,CAAYF,IAA5B,IAAsCF,GAAGI,QAAH,IAAeJ,GAAGI,QAAH,CAAYC,aAA7E,GAA8FL,GAAGE,IAA9G;AACA,WAAO,CAACA,OAAO,gBAAgBA,IAAhB,GAAuB,GAA9B,GAAoC,qBAArC,KAA+DF,GAAGG,MAAH,IAAaH,GAAGI,QAAhB,IAA4BJ,GAAGI,QAAH,CAAYE,MAAxC,GAAiD,UAAUN,GAAGI,QAAH,IAAeJ,GAAGI,QAAH,CAAYE,MAArC,CAAjD,GAAgG,EAA/J,CAAP;AACD;;AAED,MAAI,CAACR,QAAQS,GAAb,EAAkB;AAChBC,YAAQC,IAAR,CAAa,+BAAb;AACA;AACD;;AAGDf,QAAMgB,MAAN,CAAaZ,QAAQS,GAArB,EACE;AACEI,aAASb,QAAQa;AADnB,GADF,EAIGC,SAJH,CAIajB,QAJb,EAIuBE,GAJvB,EAKGgB,OALH;;AAOAnB,QAAMoB,cAAN,CAAqB;AACnBC,UAAMjB,QAAQiB,IAAR,IAAgB;AADH,GAArB;;AAIArB,QAAMsB,cAAN,CAAqB,EAACC,aAAanB,QAAQoB,GAAtB,EAArB;;AAGAC,UAAQ,aAAR;;AAEAtB,MAAIa,MAAJ,CAAWU,YAAX,GAA0B,UAAUC,GAAV,EAAerB,EAAf,EAAmBsB,IAAnB,EAAyB;AACjDd,YAAQe,KAAR,CAAc,qBAAqBF,GAAnC;AACA,QAAMG,gBAAgBzB,oBAAoBC,EAApB,CAAtB;AACA,QAAMyB,YAAYzB,GAAGI,QAAH,IAAeJ,GAAGI,QAAH,CAAYqB,SAA7C;;AAEA/B,UAAMgC,gBAAN,CAAuBL,GAAvB,EAA4B;AAC1BM,aAAO,OADmB;AAE1BC,YAAM;AACJC,oBAAY;AADR,OAFoB;AAK1BC,aAAO;AACLN,uBAAeA,aADV;AAELC,mBAAWA,SAFN;AAGLH,cAAMA;AAHD;AALmB,KAA5B;AAWD,GAhBD;;AAkBAzB,MAAIkC,SAAJ,CAAcC,MAAd,GAAuBtC,KAAvB;AACD;;AAEDE,OAAOqC,OAAP,GAAiB,aAAjB;;AAEA,eAAerC,MAAf;;AAEA,IAAI,OAAOsC,MAAP,KAAkB,WAAlB,IAAiCA,OAAOrC,GAA5C,EAAiD;AAC/CqC,SAAOrC,GAAP,CAAWsC,GAAX,CAAevC,MAAf;AACD","file":"index.js","sourceRoot":"/Users/liwb/Desktop/liwb_work/cloud/vue-error-log","sourcesContent":["import Raven from 'raven-js';\nimport RavenVue from 'raven-js/plugins/vue';\n\nfunction plugin (Vue, options = {}) {\n  function formatComponentName(vm) {\n    if (vm.$root === vm) return 'root';\n\n    const name = vm._isVue ? (vm.$options && vm.$options.name) || (vm.$options && vm.$options._componentTag) : vm.name;\n    return (name ? 'component <' + name + '>' : 'anonymous component') + (vm._isVue && vm.$options && vm.$options.__file ? ' at ' + (vm.$options && vm.$options.__file) : '');\n  }\n\n  if (!options.dsn) {\n    console.warn('sentry dsn must be set value.');\n    return;\n  }\n\n  // init raven\n  Raven.config(options.dsn,\n    {\n      release: options.release\n    })\n    .addPlugin(RavenVue, Vue)\n    .install();\n\n  Raven.setUserContext({\n    user: options.user || ''\n  });\n\n  Raven.setTagsContext({environment: options.env});\n\n  // global error\n  require('./globalLog');\n  // vue errorHandler\n  Vue.config.errorHandler = function (err, vm, info) {\n    console.error('这里是errorHandler：' + err);\n    const componentName = formatComponentName(vm);\n    const propsData = vm.$options && vm.$options.propsData;\n\n    Raven.captureException(err, {\n      level: 'error',\n      tags: {\n        svn_commit: 'vue'\n      },\n      extra: {\n        componentName: componentName,\n        propsData: propsData,\n        info: info\n      }\n    });\n  };\n  // 挂载到vue属性上\n  Vue.prototype.$raven = Raven;\n}\n\nplugin.version = '__VERSION__';\n\nexport default plugin;\n\nif (typeof window !== 'undefined' && window.Vue) {\n  window.Vue.use(plugin);\n}\n"]}